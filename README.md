# AdminMonitoring System (AMS)

![Version](https://img.shields.io/badge/version-1.0-blue.svg)
![Python](https://img.shields.io/badge/Python-3.6+-green.svg)
![License](https://img.shields.io/badge/license-MIT-lightgrey.svg)

## üìë Table des mati√®res

- [Introduction](#introduction)
- [Fonctionnalit√©s](#fonctionnalit√©s)
- [Installation](#installation)
- [Architecture du projet](#architecture-du-projet)
- [Interface utilisateur](#interface-utilisateur)
- [Modules principaux](#modules-principaux)
- [Configuration avanc√©e](#configuration-avanc√©e)
- [D√©pannage](#d√©pannage)
- [Documentation technique](#documentation-technique)
- [Cr√©dits](#cr√©dits)

## üìã Introduction

AdminMonitoring System (AMS) est une solution compl√®te de surveillance syst√®me d√©velopp√©e dans le cadre du cours de Syst√®me et R√©seau. Cette application permet le suivi en temps r√©el des m√©triques essentielles d'un serveur, g√©n√®re des visualisations graphiques et alerte en cas de d√©passement de seuils critiques.

**Objectifs p√©dagogiques:**

- Application pratique des concepts de programmation syst√®me
- Utilisation de Python pour la surveillance de ressources
- Impl√©mentation d'une base de donn√©es pour le stockage de m√©triques
- Cr√©ation d'une interface web avec Flask
- Automatisation des alertes et notifications

## ‚ú® Fonctionnalit√©s

### Surveillance syst√®me
- **Monitoring CPU**: Suivi du pourcentage d'utilisation processeur
- **Monitoring RAM**: Suivi du pourcentage d'utilisation m√©moire
- **Monitoring Disque**: Suivi du pourcentage d'espace disque utilis√©

### Visualisation des donn√©es
- **Graphiques historiques**: Visualisation des tendances d'utilisation
- **Interface web**: Tableau de bord ergonomique et responsive
- **Actualisation en temps r√©el**: Rafra√Æchissement sur demande des donn√©es

### Syst√®me d'alertes
- **Alertes par email**: Notifications automatiques
- **Seuils configurables**: Personnalisation des niveaux d'alerte
- **Anti-spam**: Intervalle minimal entre les alertes similaires

### S√©curit√©
- **Veille CERT**: Int√©gration des alertes de s√©curit√© du CERT-FR
- **Affichage centralis√©**: Toutes les informations critiques au m√™me endroit

## üîß Installation

### Pr√©requis
- Syst√®me Linux/macOS
- Python 3.6+
- pip (gestionnaire de paquets Python)
- Connexion Internet (pour les mises √† jour et alertes CERT)

### M√©thode rapide (recommand√©e)
```bash
git clone https://github.com/username/ams.git
cd ams
chmod +x install.sh
./install.sh
```

### Installation manuelle des d√©pendances
Si le script automatique √©choue, vous pouvez installer manuellement les d√©pendances:

```bash
pip install -r requirements.txt
```

## üèó Architecture du projet

### Structure des r√©pertoires
```
ams/
‚îú‚îÄ‚îÄ sondes/            # Scripts de collecte des m√©triques
‚îú‚îÄ‚îÄ stockage/          # Gestion de la base de donn√©es
‚îú‚îÄ‚îÄ graphiques/        # G√©n√©ration des visualisations
‚îú‚îÄ‚îÄ alertes/           # Syst√®me de notification
‚îú‚îÄ‚îÄ website/           # Interface web Flask
‚îú‚îÄ‚îÄ parseur/           # Module de surveillance CERT
‚îî‚îÄ‚îÄ mail/              # Gestion des emails
```

### Flux de donn√©es
1. Les sondes collectent les donn√©es brutes du syst√®me
2. Le module de stockage enregistre ces donn√©es dans une base SQLite
3. Le module graphiques g√©n√®re des visualisations √† partir de ces donn√©es
4. Le module alertes v√©rifie les d√©passements de seuils
5. L'interface web affiche toutes ces informations de fa√ßon centralis√©e

## üñ• Interface utilisateur

### D√©marrage de l'application
```bash
python3 website/app.py
```

Acc√©dez ensuite √† votre tableau de bord via: http://localhost:4000

### √âl√©ments de l'interface
- **Cards de m√©triques**: Affichent les valeurs actuelles CPU, RAM, disque
- **Graphiques historiques**: Visualisation temporelle des m√©triques
- **Tableau des alertes CERT**: Affiche les alertes de s√©curit√© r√©centes
- **Bouton "Rafra√Æchir"**: Met √† jour les donn√©es et graphiques manuellement

### Utilisation quotidienne recommand√©e
- Consultez r√©guli√®rement le tableau de bord pour surveiller l'√©tat du syst√®me
- Configurez le syst√®me pour d√©marrer automatiquement au boot (voir ci-dessous)
- Configurez les alertes email avec vos param√®tres SMTP personnels

### Configuration de d√©marrage automatique (systemd)
Cr√©ez un fichier service systemd:

```bash
sudo nano /etc/systemd/system/ams.service
```

Contenu du fichier:
```
[Unit]
Description=AdminMonitoring System
After=network.target

[Service]
User=votre_utilisateur
WorkingDirectory=/chemin/vers/ams
ExecStart=/usr/bin/python3 website/app.py
Restart=always

[Install]
WantedBy=multi-user.target
```

Activez le service:
```bash
sudo systemctl enable ams.service
sudo systemctl start ams.service
```

## üì¶ Modules principaux

### Syst√®me de sondes (sondes/)
Les sondes sont des scripts l√©gers qui collectent les m√©triques syst√®mes:

- **cpu.py**: Utilise psutil pour mesurer l'utilisation CPU
- **ram.py**: Analyse la m√©moire via psutil
- **disk.sh**: Script bash qui utilise df pour l'espace disque

Chaque sonde renvoie un objet JSON standardis√© pour faciliter l'interop√©rabilit√©.

### Gestion des donn√©es (stockage/)
Module central qui g√®re la persistance des donn√©es:

- **gerer_stockage.py**:
  - `GestionnaireBDD`: Interface avec la base SQLite
  - `GestionnaireSondes`: Ex√©cute les sondes et enregistre les donn√©es
- **main.py**: Orchestration de la collecte p√©riodique
- **back_up.py**: Cr√©ation de sauvegardes
- **back_up_restore.py**: Restauration de donn√©es

### Visualisation (graphiques/)
Module responsable de la cr√©ation des graphiques:

- **graphic.py**: Utilise Matplotlib pour cr√©er des visualisations temporelles
- `GenerateurGraphiques`: Classe principale qui g√®re la cr√©ation des graphiques

### Syst√®me d'alertes (alertes/)
Module qui d√©tecte et notifie les situations critiques:

- **alertes.py**:
  - V√©rifie si les m√©triques d√©passent les seuils configur√©s
  - Envoie des emails d'alerte via le module mail
  - Maintient un journal des alertes pour r√©f√©rence

### Interface web (website/)
Application web Flask qui centralise toutes les informations:

- **app.py**: Serveur Flask avec routes `/` et `/refresh`
- **index.html**: Template Bootstrap responsive

### Surveillance CERT (parseur/)
Module qui surveille les alertes de s√©curit√© officielles:

- **parseur.py**:
  - Analyse les alertes du CERT-FR
  - Stocke les alertes dans une base de donn√©es
  - Met √† jour les informations p√©riodiquement

## ‚öô Configuration avanc√©e

### Modification des seuils d'alerte
Le syst√®me permet de configurer les seuils d'alerte facilement via un fichier JSON sans avoir √† modifier le code source.

#### Utilisation du fichier seuils.json
√âditez le fichier `alertes/seuils.json` pour personnaliser vos seuils d'alertes:

```json
{
  "cpu": 90,     // Pourcentage d'utilisation CPU
  "ram": 80,     // Pourcentage d'utilisation RAM
  "disk": 85,    // Pourcentage d'espace disque utilis√©
  "intervalle_alertes": 30  // Minutes entre deux alertes du m√™me type
}
```

### Configuration de l'envoi d'emails
Cr√©ez le fichier `mail/config.py` s'il n'existe pas:
```python
SMTP_SERVER = 'smtp.gmail.com'
SMTP_PORT = 587
SMTP_USERNAME = 'votre.email@gmail.com'
SMTP_PASSWORD = 'votre_mot_de_passe'
DEST_EMAIL = 'destinataire@example.com'
```

Modifiez `mail.py` pour configurer votre serveur SMTP:
```python
def envoyer_alerte(sujet, message):
    # Configuration du serveur SMTP
    server = smtplib.SMTP(config.SMTP_SERVER, config.SMTP_PORT)
    server.starttls()
    server.login(config.SMTP_USERNAME, config.SMTP_PASSWORD)
    
    # Construction du message
    msg = MIMEText(message)
    msg['Subject'] = sujet
    msg['From'] = config.SMTP_USERNAME
    msg['To'] = config.DEST_EMAIL
    
    # Envoi
    server.send_message(msg)
    server.quit()
```

### Param√©trage de l'interface web
Pour modifier le port ou activer le mode debug, √©ditez `app.py`:
```python
if __name__ == '__main__':
    app.run(host='0.0.0.0', port=4000, debug=True)
```

### Configuration de la r√©tention de donn√©es
Pour modifier la politique de conservation des donn√©es, √©ditez `gerer_stockage.py`:
```python
# Conserver les donn√©es pendant 30 jours
RETENTION_JOURS = 30

def nettoyer_donnees_anciennes():
    date_limite = datetime.now() - timedelta(days=RETENTION_JOURS)
    # SQL pour supprimer les donn√©es plus anciennes que date_limite
```

### Fr√©quence de collecte
Modifiez l'intervalle de collecte dans `main.py`:
```python
# Collecter les donn√©es toutes les 5 minutes
INTERVALLE_MINUTES = 5
```

## üõ† D√©pannage

### Probl√®mes courants et solutions
1. **Base de donn√©es inaccessible ou corrompue**
   - Sauvegardez vos donn√©es
   - Supprimez la base courante
   - Restaurez √† partir d'une sauvegarde ou cr√©ez une nouvelle base

2. **Erreurs de permission sur les scripts**
   - V√©rifiez les permissions: `ls -la sondes/`
   - Ajoutez les permissions d'ex√©cution: `chmod +x sondes/*.py sondes/*.sh`

3. **Probl√®mes d'envoi d'emails**
   - V√©rifiez la configuration SMTP dans `mail/config.py`
   - Pour Gmail, activez "Autoriser les applications moins s√©curis√©es"
   - Testez avec `python -m mail.test_mail`

4. **Interface web inaccessible**
   - V√©rifiez que Flask est en cours d'ex√©cution
   - Confirmez le port utilis√© (par d√©faut: 4000)
   - V√©rifiez les r√®gles de pare-feu

5. **Aucune donn√©e affich√©e**
   - V√©rifiez que les sondes fonctionnent correctement
   - Consultez les logs pour d√©tecter d'√©ventuelles erreurs

### Journal des erreurs
Le syst√®me maintient plusieurs fichiers de log:
- `alertes/alertes.log`: Journal des alertes envoy√©es
- `cron.log`: Si configur√© avec cron, journal des ex√©cutions p√©riodiques

## üìñ Documentation technique

### Structure de la base de donn√©es
- **Table sondes** (`table_sondes.sqlite`)
  ```
  id INTEGER PRIMARY KEY
  timestamp DATETIME
  type TEXT
  valeur REAL
  ```

- **Table alertes** (`parseur.sqlite`)
  ```
  id INTEGER PRIMARY KEY
  date DATETIME
  titre TEXT
  description TEXT
  niveau TEXT
  url TEXT
  ```

### Format des donn√©es des sondes
Chaque sonde retourne un objet JSON avec une cl√© unique:
```json
{
  "cpu": 45.2,
  "timestamp": "2023-04-01 14:30:25"
}
```

### Algorithme de d√©tection des alertes
1. R√©cup√©ration de la derni√®re valeur de chaque m√©trique
2. Comparaison avec les seuils configur√©s
3. Si d√©passement, v√©rification de l'historique r√©cent
4. Si aucune alerte similaire r√©cente, envoi d'un email
5. Mise √† jour du journal des alertes

### Cycle de vie des donn√©es
1. **Collecte**: Ex√©cution des sondes √† intervalles r√©guliers
2. **Stockage**: Insertion dans la base SQLite
3. **Traitement**: G√©n√©ration des graphiques, v√©rification des seuils
4. **Purge**: Suppression des donn√©es anciennes (limite configurable)
5. **Sauvegarde**: Cr√©ation p√©riodique de backups

## üìù Cr√©dits

- **D√©veloppeur**: Alexi Miaille
- **Contexte**: Cours de Syst√®me et R√©seau (L2 Informatique)
- **Ann√©e**: 2025

### Licence
Ce projet est distribu√© sous licence MIT √† des fins √©ducatives uniquement.

> "La simplicit√© est la sophistication supr√™me." - Leonardo da Vinci